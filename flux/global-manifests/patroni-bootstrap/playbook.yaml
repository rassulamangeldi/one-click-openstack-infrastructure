---

- hosts: all
  become: true
  pre_tasks:
    - name: 'ntp | Set Timezone'
      timezone:
        name: "{{ ntp_timezone }}"
      tags:
        - ntp
    - name: "postgres-exporter | Upload queries config file"
      copy:
        src: "playbooks/files/postgres-exporter.yaml"
        dest: "{{ postgres_exporter_config_dest }}"
        owner: root
        group: root
        mode: 0644
      tags:
        - grafana
  roles:
    - role: manage-lvm
      tags: lvm

    - role: ntp
      tags: ntp

    - role: alloy
      tags: grafana

- hosts: postgres_cluster
  become: true
  roles:

    - role: postgresql-users
      when: is_master | bool
      tags: 
        - never
        - user
